[2024-04-14T18:45:41.732+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-04-14T18:45:41.744+0000] {taskinstance.py:2073} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: upload_csv_to_s3.generate_and_upload_csv manual__2024-04-14T18:40:24.887799+00:00 [queued]>
[2024-04-14T18:45:41.749+0000] {taskinstance.py:2073} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: upload_csv_to_s3.generate_and_upload_csv manual__2024-04-14T18:40:24.887799+00:00 [queued]>
[2024-04-14T18:45:41.749+0000] {taskinstance.py:2303} INFO - Starting attempt 2 of 2
[2024-04-14T18:45:41.757+0000] {taskinstance.py:2327} INFO - Executing <Task(PythonOperator): generate_and_upload_csv> on 2024-04-14 18:40:24.887799+00:00
[2024-04-14T18:45:41.768+0000] {warnings.py:110} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:61: DeprecationWarning: This process (pid=2349) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-04-14T18:45:41.770+0000] {standard_task_runner.py:63} INFO - Started process 2351 to run task
[2024-04-14T18:45:41.770+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'upload_csv_to_s3', 'generate_and_upload_csv', 'manual__2024-04-14T18:40:24.887799+00:00', '--job-id', '23', '--raw', '--subdir', 'DAGS_FOLDER/test_dag.py', '--cfg-path', '/tmp/tmpxxfq05p1']
[2024-04-14T18:45:41.771+0000] {standard_task_runner.py:91} INFO - Job 23: Subtask generate_and_upload_csv
[2024-04-14T18:45:41.799+0000] {task_command.py:426} INFO - Running <TaskInstance: upload_csv_to_s3.generate_and_upload_csv manual__2024-04-14T18:40:24.887799+00:00 [running]> on host 514aa00dce91
[2024-04-14T18:45:41.862+0000] {taskinstance.py:2644} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='upload_csv_to_s3' AIRFLOW_CTX_TASK_ID='generate_and_upload_csv' AIRFLOW_CTX_EXECUTION_DATE='2024-04-14T18:40:24.887799+00:00' AIRFLOW_CTX_TRY_NUMBER='2' AIRFLOW_CTX_DAG_RUN_ID='manual__2024-04-14T18:40:24.887799+00:00'
[2024-04-14T18:45:41.863+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-04-14T18:45:42.613+0000] {logging_mixin.py:188} INFO - []
[2024-04-14T18:45:42.616+0000] {logging_mixin.py:188} INFO - Processing section: 16
[2024-04-14T18:45:44.857+0000] {logging_mixin.py:188} INFO -     product_id  classification_id  ... measure quantity
0        22682                 16  ...      KG      4.0
1        22680                 16  ...      KG      4.0
2          975                 16  ...      KG      1.8
3          976                 16  ...      KG      2.0
4        22681                 16  ...      KG      1.8
5        22621                 16  ...       G    170.0
6        13706                 16  ...      UN      1.0
7        13707                 16  ...      UN      2.0
8        13443                 16  ...      UN      1.0
9        13709                 16  ...      UN      1.0
10       13711                 16  ...      UN      1.0
11       13380                 16  ...      UN      1.0
12       13379                 16  ...      UN      1.0
13       13713                 16  ...      UN      1.0
14       13335                 16  ...      UN      1.0
15       20765                 16  ...      KG      0.6
16       13333                 16  ...      UN      1.0
17       13334                 16  ...      KG      0.0
18       13332                 16  ...      UN      1.0
19       19229                 16  ...       L      0.5
20       20767                 16  ...      KG      0.6
21       13454                 16  ...      UN      1.0
22       22619                 16  ...      KG      0.6
23       20764                 16  ...      KG      0.6
24       12766                 16  ...       L      0.5
25       13422                 16  ...      UN      1.0
26       13463                 16  ...      UN     60.0
27       20772                 16  ...      KG      0.6
28       13425                 16  ...      UN      1.0
29       13424                 16  ...      UN      1.0
30       13423                 16  ...      UN      1.0
31       22684                 16  ...       L      2.0
32       22685                 16  ...       L      2.0
33       22673                 16  ...       L      2.0
34        5704                 16  ...      UN      4.0
35        7929                 16  ...      UN      1.0
36       10007                 16  ...      UN      6.0
37        9040                 16  ...      UN      6.0
38       10392                 16  ...      UN     10.0
39       11750                 16  ...      UN     10.0
40        7710                 16  ...      UN     10.0
41       10006                 16  ...      UN      6.0
42       22622                 16  ...       G     70.0
43       20785                 16  ...       G     70.0
44       20783                 16  ...       G     70.0
45       20784                 16  ...       G     70.0
46       20771                 16  ...      KG      0.6
47        5388                 16  ...      UN      1.0
48       12027                 16  ...       L      0.5
49        7452                 16  ...       L      0.5
50        8008                 16  ...       L      0.5
51        8829                 16  ...       L      0.5
52        9824                 16  ...      UN     30.0
53        7080                 16  ...      UN      6.0
54       15483                 16  ...      UN     30.0
55       15482                 16  ...      UN      6.0
56       23851                 16  ...      UN     30.0
57       15212                 16  ...      UN     50.0

[58 rows x 9 columns]
[2024-04-14T18:45:44.881+0000] {base.py:84} INFO - Using connection ID 'aws_default' for task execution.
[2024-04-14T18:45:44.884+0000] {connection_wrapper.py:384} INFO - AWS Connection (conn_id='aws_default', conn_type='aws') credentials retrieved from login and password.
[2024-04-14T18:45:45.864+0000] {connection.py:547} WARNING - Certificate did not match expected hostname: verdemar-dataset.s3.s3.amazonaws.com. Certificate: {'subject': ((('commonName', '*.s3.amazonaws.com'),),), 'issuer': ((('countryName', 'US'),), (('organizationName', 'Amazon'),), (('commonName', 'Amazon RSA 2048 M01'),)), 'version': 3, 'serialNumber': '0B6D5022ACE696556FCC0827EBA0C09A', 'notBefore': 'Oct 10 00:00:00 2023 GMT', 'notAfter': 'Jul  3 23:59:59 2024 GMT', 'subjectAltName': (('DNS', '*.s3.amazonaws.com'), ('DNS', 's3.amazonaws.com')), 'OCSP': ('http://ocsp.r2m01.amazontrust.com',), 'caIssuers': ('http://crt.r2m01.amazontrust.com/r2m01.cer',), 'crlDistributionPoints': ('http://crl.r2m01.amazontrust.com/r2m01.crl',)}
[2024-04-14T18:45:47.193+0000] {connection.py:547} WARNING - Certificate did not match expected hostname: verdemar-dataset.s3.s3.amazonaws.com. Certificate: {'subject': ((('commonName', '*.s3.amazonaws.com'),),), 'issuer': ((('countryName', 'US'),), (('organizationName', 'Amazon'),), (('commonName', 'Amazon RSA 2048 M01'),)), 'version': 3, 'serialNumber': '0B6D5022ACE696556FCC0827EBA0C09A', 'notBefore': 'Oct 10 00:00:00 2023 GMT', 'notAfter': 'Jul  3 23:59:59 2024 GMT', 'subjectAltName': (('DNS', '*.s3.amazonaws.com'), ('DNS', 's3.amazonaws.com')), 'OCSP': ('http://ocsp.r2m01.amazontrust.com',), 'caIssuers': ('http://crt.r2m01.amazontrust.com/r2m01.cer',), 'crlDistributionPoints': ('http://crl.r2m01.amazontrust.com/r2m01.crl',)}
[2024-04-14T18:45:48.436+0000] {connection.py:547} WARNING - Certificate did not match expected hostname: verdemar-dataset.s3.s3.amazonaws.com. Certificate: {'subject': ((('commonName', '*.s3.amazonaws.com'),),), 'issuer': ((('countryName', 'US'),), (('organizationName', 'Amazon'),), (('commonName', 'Amazon RSA 2048 M01'),)), 'version': 3, 'serialNumber': '0B6D5022ACE696556FCC0827EBA0C09A', 'notBefore': 'Oct 10 00:00:00 2023 GMT', 'notAfter': 'Jul  3 23:59:59 2024 GMT', 'subjectAltName': (('DNS', '*.s3.amazonaws.com'), ('DNS', 's3.amazonaws.com')), 'OCSP': ('http://ocsp.r2m01.amazontrust.com',), 'caIssuers': ('http://crt.r2m01.amazontrust.com/r2m01.cer',), 'crlDistributionPoints': ('http://crl.r2m01.amazontrust.com/r2m01.crl',)}
[2024-04-14T18:45:51.903+0000] {connection.py:547} WARNING - Certificate did not match expected hostname: verdemar-dataset.s3.s3.amazonaws.com. Certificate: {'subject': ((('commonName', '*.s3.amazonaws.com'),),), 'issuer': ((('countryName', 'US'),), (('organizationName', 'Amazon'),), (('commonName', 'Amazon RSA 2048 M01'),)), 'version': 3, 'serialNumber': '0B6D5022ACE696556FCC0827EBA0C09A', 'notBefore': 'Oct 10 00:00:00 2023 GMT', 'notAfter': 'Jul  3 23:59:59 2024 GMT', 'subjectAltName': (('DNS', '*.s3.amazonaws.com'), ('DNS', 's3.amazonaws.com')), 'OCSP': ('http://ocsp.r2m01.amazontrust.com',), 'caIssuers': ('http://crt.r2m01.amazontrust.com/r2m01.cer',), 'crlDistributionPoints': ('http://crl.r2m01.amazontrust.com/r2m01.crl',)}
[2024-04-14T18:45:57.593+0000] {connection.py:547} WARNING - Certificate did not match expected hostname: verdemar-dataset.s3.s3.amazonaws.com. Certificate: {'subject': ((('commonName', '*.s3.amazonaws.com'),),), 'issuer': ((('countryName', 'US'),), (('organizationName', 'Amazon'),), (('commonName', 'Amazon RSA 2048 M01'),)), 'version': 3, 'serialNumber': '0B6D5022ACE696556FCC0827EBA0C09A', 'notBefore': 'Oct 10 00:00:00 2023 GMT', 'notAfter': 'Jul  3 23:59:59 2024 GMT', 'subjectAltName': (('DNS', '*.s3.amazonaws.com'), ('DNS', 's3.amazonaws.com')), 'OCSP': ('http://ocsp.r2m01.amazontrust.com',), 'caIssuers': ('http://crt.r2m01.amazontrust.com/r2m01.cer',), 'crlDistributionPoints': ('http://crl.r2m01.amazontrust.com/r2m01.crl',)}
[2024-04-14T18:45:57.595+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-04-14T18:45:57.596+0000] {taskinstance.py:2890} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 715, in urlopen
    httplib_response = self._make_request(
                       ^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 404, in _make_request
    self._validate_conn(conn)
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 1058, in _validate_conn
    conn.connect()
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 472, in connect
    _match_hostname(cert, self.assert_hostname or server_hostname)
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 545, in _match_hostname
    match_hostname(cert, asserted_hostname)
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/util/ssl_match_hostname.py", line 150, in match_hostname
    raise CertificateError(
urllib3.util.ssl_match_hostname.CertificateError: hostname 'verdemar-dataset.s3.s3.amazonaws.com' doesn't match either of '*.s3.amazonaws.com', 's3.amazonaws.com'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/httpsession.py", line 464, in send
    urllib_response = conn.urlopen(
                      ^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 799, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/util/retry.py", line 525, in increment
    raise six.reraise(type(error), error, _stacktrace)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/packages/six.py", line 769, in reraise
    raise value.with_traceback(tb)
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 715, in urlopen
    httplib_response = self._make_request(
                       ^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 404, in _make_request
    self._validate_conn(conn)
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 1058, in _validate_conn
    conn.connect()
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 472, in connect
    _match_hostname(cert, self.assert_hostname or server_hostname)
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 545, in _match_hostname
    match_hostname(cert, asserted_hostname)
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/util/ssl_match_hostname.py", line 150, in match_hostname
    raise CertificateError(
urllib3.exceptions.SSLError: hostname 'verdemar-dataset.s3.s3.amazonaws.com' doesn't match either of '*.s3.amazonaws.com', 's3.amazonaws.com'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 400, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/test_dag.py", line 84, in run_etl_process
    s3_client.put_object(Bucket=bucket_name, Key=file_key, Body=csv_buffer.getvalue())
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/client.py", line 553, in _api_call
    return self._make_api_call(operation_name, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/client.py", line 989, in _make_api_call
    http, parsed_response = self._make_request(
                            ^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/client.py", line 1015, in _make_request
    return self._endpoint.make_request(operation_model, request_dict)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/endpoint.py", line 119, in make_request
    return self._send_request(request_dict, operation_model)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/endpoint.py", line 202, in _send_request
    while self._needs_retry(
          ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/endpoint.py", line 354, in _needs_retry
    responses = self._event_emitter.emit(
                ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/hooks.py", line 412, in emit
    return self._emitter.emit(aliased_event_name, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/hooks.py", line 256, in emit
    return self._emit(event_name, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/hooks.py", line 239, in _emit
    response = handler(**kwargs)
               ^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/retryhandler.py", line 207, in __call__
    if self._checker(**checker_kwargs):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/retryhandler.py", line 284, in __call__
    should_retry = self._should_retry(
                   ^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/retryhandler.py", line 320, in _should_retry
    return self._checker(attempt_number, response, caught_exception)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/retryhandler.py", line 363, in __call__
    checker_response = checker(
                       ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/retryhandler.py", line 247, in __call__
    return self._check_caught_exception(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/retryhandler.py", line 416, in _check_caught_exception
    raise caught_exception
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/endpoint.py", line 281, in _do_get_response
    http_response = self._send(request)
                    ^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/endpoint.py", line 377, in _send
    return self.http_session.send(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/botocore/httpsession.py", line 491, in send
    raise SSLError(endpoint_url=request.url, error=e)
botocore.exceptions.SSLError: SSL validation failed for https://verdemar-dataset.s3.s3.amazonaws.com/products_20240414.csv hostname 'verdemar-dataset.s3.s3.amazonaws.com' doesn't match either of '*.s3.amazonaws.com', 's3.amazonaws.com'
[2024-04-14T18:45:57.631+0000] {taskinstance.py:1205} INFO - Marking task as FAILED. dag_id=upload_csv_to_s3, task_id=generate_and_upload_csv, execution_date=20240414T184024, start_date=20240414T184541, end_date=20240414T184557
[2024-04-14T18:45:57.653+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 23 for task generate_and_upload_csv (SSL validation failed for https://verdemar-dataset.s3.s3.amazonaws.com/products_20240414.csv hostname 'verdemar-dataset.s3.s3.amazonaws.com' doesn't match either of '*.s3.amazonaws.com', 's3.amazonaws.com'; 2351)
[2024-04-14T18:45:57.669+0000] {local_task_job_runner.py:240} INFO - Task exited with return code 1
[2024-04-14T18:45:57.682+0000] {taskinstance.py:3482} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-04-14T18:45:57.683+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
